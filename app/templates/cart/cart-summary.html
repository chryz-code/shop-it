{% extends 'app/base.html' %} {% load static %} {% block title %}<title>Shop !t - Cart</title>{% endblock %} {% block content %}
<div style="margin-top: 150px">
  <h1>My Cart</h1>
  {% for item in cart %} {% with product=item.product %}
  <a href="" data-index="{{product.id}}" class="product-item">
    <div>
      <img src="{{ product.image_1.url }}" alt="" />
      <p>{{ product.name }}</p>
      <p>{{product.price}}</p>
    </div>
    <div>
      <select id="select{{product.id}}">
        <option selected>{{item.qty}}</option>
        <div class="list">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </div>
      </select>


      <button type="button" id="update-cart-btn" data-index=""="{{product.id}}" class="update-cart-btn" >Update</button>
      <button type="button" id="delete-from-cart-btn" data-index=""="{{product.id}}" class="delete-from-cart-btn" >Delete</button>
    </div>
  </a>

  {% endwith %} {% endfor %}
  <div>
      Sub Total: <span id="subtotal">{{cart.get_total_price  }}</span>
  </div>
</div>
<script>
    //add item

  $(document).on("click", ".delete-from-cart-btn", function (e) {
      e.preventDefault()
      var prodid = $(this).data('index');
    $.ajax({
      type: "POST",
      url: "{% url 'cart:delete_form_cart' %}",
      data: {
        productid: $(this).data('index'),
        csrfmiddlewaretoken: "{{ csrf_token }}",
        action: "post",
      },
      success: function (json) {
        $('.product-item[data-index="'+ prodid +'"]').remove()
        document.getElementById("subtotal").innerHTML = json.subtotal
        document.getElementById("product-cart-qty").innerHTML = json.qty
      },
      error: function (xhr, errmsg, err) {},
    });
  });

  //update item 

  $(document).on("click", ".update-cart-btn", function (e) {
      e.preventDefault()
      var prodid = $(this).data('index');
    $.ajax({
      type: "POST",
      url: "{% url 'cart:update_cart' %}",
      data: {
        productid: $(this).data('index'),
        productqty: $('#select'+ prodid +' option:selected').text(),
        csrfmiddlewaretoken: "{{ csrf_token }}",
        action: "post",
      },
      success: function (json) {
       document.getElementById("product-cart-qty").innerHTML = json.qty
       document.getElementById("subtotal").innerHTML = json.subtotal
      },
      error: function (xhr, errmsg, err) {},
    });
  });
</script>
{% endblock %}
